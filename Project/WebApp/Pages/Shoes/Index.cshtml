@page
@model WebApp.Pages.Shoes.IndexModel

@{
    ViewData["Title"] = "Список товаров";
}

<h1>Список товаров</h1>

<form method="get">
    <input type="text"
           name="description"
           value="@Model.Description"
           placeholder="Поиск..."
           onchange="this.form.submit()"
           class="form-control" />

    <div>
        <input type="checkbox" name="hasDiscount" value="true" @(Model.HasDiscount ? "checked" : "") onchange="this.form.submit()" /> Только со скидкой
    </div>

    <div>
        <input type="checkbox" name="inStock" value="true" @(Model.InStock ? "checked" : "") onchange="this.form.submit()" /> Только в наличии
    </div>

    <h5>Фильтр по бренду</h5>
    <select class="form-control"
            name="sortBrand"
            onchange="this.form.submit()">
        <option value="">Все бренды</option>
        @foreach (var brand in Model.Brands)
        {
            <option value="@brand.Name" selected="@(Model.SortBrand == brand.Name)">@brand.Name</option>
        }
    </select>

    <h5>Сортировка</h5>
    <select class="form-control"
            name="sortShoe"
            onchange="this.form.submit()">
        <option value="">По умолчанию</option>
        <option value="name" selected="@(Model.SortShoe == "name")">По названию</option>
        <option value="vendor" selected="@(Model.SortShoe == "vendor")">По поставщику</option>
        <option value="price" selected="@(Model.SortShoe == "price")">По цене</option>
        <option value="price_desc" selected="@(Model.SortShoe == "price_desc")">По цене (убыв.)</option>
    </select>

    <h5>Фильтр по цене</h5>
    <input type="text"
           name="price"
           value="@Model.Price"
           placeholder="Цена до..."
           onchange="this.form.submit()"
           class="form-control"
           oninput="this.value = this.value.replace(/[^0-9]/g, '')" 
           onkeypress="return allowOnlyNumbers(event)"
           style="margin-bottom: 20px"/>
</form>

@foreach (var item in Model.Shoe) {
    <div style="display:flex; align-items:center; margin-bottom:20px; border:1px solid #ccc; padding:10px;" class="@(item.Discount > 15 ? "high-discount" : "")">

        <div style="width:180px;">
            <img src="@(string.IsNullOrEmpty(item.Photo) ? "Images/picture.png" : $"Images/{item.Photo}")" style="width:160px; height:160px;" />
        </div>

        <div style="flex:1; padding:0 20px">
            <div><strong>@item.Category.Name</strong></div>
            <div>Описание товара: @item.Description</div>
            <div>Производитель: @item.Brand.Name</div>
            <div>Поставщик: @item.Vendor.Name</div>
            <div>
                Цена: <s>@((item.Discount == 0) ? "" : item.Price)</s> @(item.Price - item.Price * item.Discount / 100)
            </div>
            <div>Размер: @item.Size</div>
            <div>Количество на складе: @item.Quantity</div>
        </div>

        <div style="width:120px; text-align:right; flex-direction: column">
            <font style="font-size: 35px; color: red; font-weight:bold"> @((item.Discount == 0) ? "" : $"{item.Discount}%")</font>
            <br />
            <form method="post" asp-page-handler="Order" style="display: inline;">
                <button type="submit" name="shoeId" value="@item.ShoeId" class="btn action-highlight" disabled="@(item.Quantity <= 0)">Заказать</button>
            </form>
        </div>

    </div>



}

